<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒ—äº¬ Â· ä¸¹éº¦ Â· å¤©æ°”ä¸æ–°é—»</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif; }
    body, html { overflow: hidden; height: 100%; }
    /* åŒ—æ¬§å†·æ·¡è‰²è°ƒ */
    .nordic-bg { background: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%); }
    .nordic-card { border: 1px solid rgba(148,163,184,0.25); transition: background 0.4s, color 0.3s, border-color 0.3s; }
    .card-day { background: rgba(255,255,255,0.95); color: #1e293b; }
    .card-day .card-text-muted { color: #64748b; }
    .card-night { background: #1e293b; color: #e2e8f0; border-color: rgba(148,163,184,0.2); }
    .card-night .card-text-muted { color: #94a3b8; }
    .nordic-accent { color: #334155; }
    .nordic-muted { color: #64748b; }
    .nordic-btn-active { background: #475569; color: #f8fafc; }
    .clock-icon { width: 28px; height: 28px; flex-shrink: 0; }
    #news-section { scrollbar-width: none; -ms-overflow-style: none; }
    #news-section::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="h-screen nordic-bg antialiased overflow-hidden">
  <div class="h-screen flex flex-col lg:flex-row overflow-hidden">
    <!-- å·¦ä¾§ï¼šåŒ—äº¬ä¸ä¸¹éº¦ - ç»Ÿä¸€æ—¶é—´+å¤©æ°”å¸ƒå±€ -->
    <div class="lg:w-1/2 flex flex-col justify-center px-6 py-8 lg:px-16 lg:py-12 flex-shrink-0 space-y-8">
      <h1 class="text-2xl lg:text-3xl font-semibold nordic-accent tracking-tight">ä¸­å›½ Â· ä¸¹éº¦</h1>

      <!-- åŒ—äº¬ -->
      <div id="beijing-section" class="nordic-card card-day rounded-2xl p-6 shadow-sm">
        <div class="flex items-center gap-3 mb-4">
          <span id="beijing-day-icon" class="text-2xl">â˜€ï¸</span>
          <span class="text-lg font-medium card-text-muted">ä¸­å›½ åŒ—äº¬</span>
        </div>
        <div class="flex items-baseline gap-2 mb-4">
          <span id="beijing-time" class="text-5xl font-light tabular-nums" style="color:inherit">--:--:--</span>
        </div>
        <div id="beijing-weather-loading" class="h-12 w-32 bg-slate-200/50 rounded animate-pulse"></div>
        <div id="beijing-weather" class="hidden">
          <div class="flex items-center gap-3 text-xl">
            <span id="beijing-icon" class="text-3xl">â˜€ï¸</span>
            <span id="beijing-temp" class="font-medium text-2xl" style="color:inherit"></span><span class="card-text-muted text-xl">Â°C</span>
            <span id="beijing-desc" class="card-text-muted text-lg ml-1"></span>
          </div>
          <div id="beijing-forecast" class="flex gap-6 text-lg mt-4 card-text-muted"></div>
        </div>
        <div id="beijing-error" class="hidden text-slate-600 text-base mt-2"></div>
      </div>

      <!-- ä¸¹éº¦ -->
      <div id="denmark-section" class="nordic-card card-day rounded-2xl p-6 shadow-sm">
        <div class="flex items-center gap-3 mb-4">
          <span id="denmark-day-icon" class="text-2xl">â˜€ï¸</span>
          <span class="text-lg font-medium card-text-muted">ä¸¹éº¦ å“¥æœ¬å“ˆæ ¹</span>
        </div>
        <div class="flex items-baseline gap-2 mb-4">
          <span id="denmark-time" class="text-5xl font-light tabular-nums" style="color:inherit">--:--:--</span>
        </div>
        <div id="denmark-weather-loading" class="h-12 w-32 bg-slate-200/50 rounded animate-pulse"></div>
        <div id="denmark-weather" class="hidden">
          <div class="flex items-center gap-3 text-xl">
            <span id="denmark-icon" class="text-3xl">â˜€ï¸</span>
            <span id="denmark-temp" class="font-medium text-2xl" style="color:inherit"></span><span class="card-text-muted text-xl">Â°C</span>
            <span id="denmark-desc" class="card-text-muted text-lg ml-1"></span>
          </div>
          <div id="denmark-forecast" class="flex gap-6 text-lg mt-4 card-text-muted"></div>
        </div>
        <div id="denmark-error" class="hidden text-slate-600 text-base mt-2"></div>
      </div>
    </div>

    <!-- å³ä¾§ï¼šDR æ–°é—» -->
    <div class="lg:w-1/2 h-1/2 lg:h-full flex flex-col p-4 lg:p-8 flex-shrink-0 overflow-hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold nordic-accent">DR ä¸¹éº¦æ–°é—»</h2>
        <div class="flex gap-1 text-sm">
          <button id="lang-en" class="px-3 py-1.5 rounded nordic-btn-active font-medium">English</button>
          <button id="lang-zh" class="px-3 py-1.5 rounded bg-white/80 nordic-accent border border-slate-200 hover:bg-slate-100 transition-colors">ä¸­æ–‡</button>
          <button id="lang-da" class="px-3 py-1.5 rounded bg-white/80 nordic-accent border border-slate-200 hover:bg-slate-100 transition-colors">Dansk</button>
        </div>
      </div>
      <div id="news-section" class="flex-1 overflow-y-auto min-h-0">
        <div id="news-loading" class="space-y-3">
          <div class="h-5 bg-slate-200/50 rounded animate-pulse w-full"></div>
          <div class="h-5 bg-slate-200/50 rounded animate-pulse w-11/12"></div>
          <div class="h-5 bg-slate-200/50 rounded animate-pulse w-5/6"></div>
          <div class="h-5 bg-slate-200/50 rounded animate-pulse w-full"></div>
          <div class="h-5 bg-slate-200/50 rounded animate-pulse w-4/5"></div>
        </div>
        <div id="news-list" class="hidden space-y-2"></div>
        <div id="news-error" class="hidden text-slate-600 text-base py-4"></div>
      </div>
    </div>
  </div>

  <script>
    const WEATHER_ICONS = { 0: 'â˜€ï¸', 1: 'ğŸŒ¤ï¸', 2: 'â›…', 3: 'â˜ï¸', 45: 'ğŸŒ«ï¸', 48: 'ğŸŒ«ï¸', 51: 'ğŸŒ§ï¸', 61: 'ğŸŒ§ï¸', 80: 'ğŸŒ¦ï¸', 95: 'â›ˆï¸' };
    const WEATHER_DESC = { 0: 'æ™´æœ—', 1: 'å¤§éƒ¨åˆ†æ™´æœ—', 2: 'å±€éƒ¨å¤šäº‘', 3: 'å¤šäº‘', 45: 'æœ‰é›¾', 48: 'é›¾å‡‡', 51: 'æ¯›æ¯›é›¨', 61: 'å°é›¨', 80: 'é˜µé›¨', 95: 'é›·æš´' };
    const WEATHER_DESC_EN = { 0: 'Clear', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast', 45: 'Foggy', 48: 'Rime fog', 51: 'Drizzle', 61: 'Rain', 80: 'Showers', 95: 'Thunderstorm' };

    function isDaytime(tz) {
      const h = parseInt(new Date().toLocaleString('en', { timeZone: tz, hour: 'numeric', hour12: false }), 10);
      return h >= 6 && h < 18;
    }

    function updateClocks() {
      const now = new Date();
      document.getElementById('beijing-time').textContent = now.toLocaleTimeString('zh-CN', { timeZone: 'Asia/Shanghai', hour12: false });
      document.getElementById('denmark-time').textContent = now.toLocaleTimeString('zh-CN', { timeZone: 'Europe/Copenhagen', hour12: false });
      const beijingDay = isDaytime('Asia/Shanghai');
      const denmarkDay = isDaytime('Europe/Copenhagen');
      const sun = 'â˜€ï¸', moon = 'ğŸŒ™';
      document.getElementById('beijing-day-icon').textContent = beijingDay ? sun : moon;
      document.getElementById('denmark-day-icon').textContent = denmarkDay ? sun : moon;
      const beijingCard = document.getElementById('beijing-section');
      const denmarkCard = document.getElementById('denmark-section');
      beijingCard.classList.toggle('card-day', beijingDay);
      beijingCard.classList.toggle('card-night', !beijingDay);
      denmarkCard.classList.toggle('card-day', denmarkDay);
      denmarkCard.classList.toggle('card-night', !denmarkDay);
    }

    async function fetchWeather(lat, lon, tz) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=${tz}&forecast_days=3`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('Weather fetch failed');
      return res.json();
    }

    function renderWeather(idPrefix, data, lang) {
      const descMap = lang === 'en' ? WEATHER_DESC_EN : WEATHER_DESC;
      document.getElementById(`${idPrefix}-weather-loading`).classList.add('hidden');
      document.getElementById(`${idPrefix}-weather`).classList.remove('hidden');
      const temp = Math.round(data.current.temperature_2m);
      const code = data.current.weather_code;
      document.getElementById(`${idPrefix}-icon`).textContent = WEATHER_ICONS[code] || 'ğŸŒ¡ï¸';
      document.getElementById(`${idPrefix}-temp`).textContent = temp;
      document.getElementById(`${idPrefix}-desc`).textContent = descMap[code] || (lang === 'en' ? 'Fair' : 'å¤©æ°”é€‚å®œ');
      const maxT = data.daily?.temperature_2m_max || [];
      const minT = data.daily?.temperature_2m_min || [];
      const labels = lang === 'en' ? ['Today', 'Tomorrow', 'Day 3'] : ['ä»Šå¤©', 'æ˜å¤©', 'åå¤©'];
      document.getElementById(`${idPrefix}-forecast`).innerHTML = labels.slice(0, 3).map((l, i) =>
        `<span>${l} <strong>${Math.round(minT[i] || 0)}Â°~${Math.round(maxT[i] || 0)}Â°</strong></span>`
      ).join('');
    }

    async function fetchDRNews() {
      const rssUrl = 'https://www.dr.dk/nyheder/service/feeds/senestenyt';
      try {
        const proxyUrl = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(rssUrl);
        const res = await fetch(proxyUrl);
        const data = await res.json();
        if (data.status === 'ok' && data.items?.length) {
          return data.items.slice(0, 10).map(i => ({ title: i.title?.trim() || 'æ— æ ‡é¢˜', link: i.link, pubDate: i.pubDate }));
        }
      } catch (_) {}
      try {
        const fallback = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rssUrl);
        const res = await fetch(fallback);
        const xml = await res.text();
        const doc = new DOMParser().parseFromString(xml, 'text/xml');
        const items = Array.from(doc.querySelectorAll('item')).slice(0, 10);
        if (items.length) {
          return items.map(item => ({
            title: item.querySelector('title')?.textContent?.trim() || 'æ— æ ‡é¢˜',
            link: item.querySelector('link')?.textContent?.trim() || item.querySelector('guid')?.textContent?.trim() || '#',
            pubDate: item.querySelector('pubDate')?.textContent || item.querySelector('dc\\:date')?.textContent || item.getElementsByTagName('pubDate')[0]?.textContent || '',
          }));
        }
      } catch (_) {}
      return null;
    }

    async function translateText(text, toLang) {
      if (!text || toLang === 'da') return text;
      const pair = toLang === 'zh' ? 'da|zh-CN' : 'da|en';
      try {
        const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text.substring(0, 300))}&langpair=${pair}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.responseStatus === 200 && data.responseData?.translatedText) {
          return data.responseData.translatedText;
        }
      } catch (_) {}
      return text;
    }

    let newsData = [];
    let currentLang = 'en';

    function formatNewsDateTime(pubDate) {
      if (!pubDate) return '';
      try {
        const d = new Date(pubDate);
        if (isNaN(d.getTime())) return '';
        return d.toLocaleString('en-GB', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' });
      } catch { return ''; }
    }

    function setNewsLang(lang) {
      currentLang = lang;
      document.querySelectorAll('[id^=lang-]').forEach(btn => {
        const active = btn.id === 'lang-' + lang;
        btn.className = active ? 'px-3 py-1.5 rounded nordic-btn-active font-medium' : 'px-3 py-1.5 rounded bg-white/80 nordic-accent border border-slate-200 hover:bg-slate-100 transition-colors';
      });
      renderNewsList(newsData, lang);
    }

    function renderNewsList(items, lang) {
      const list = document.getElementById('news-list');
      if (!items?.length) return;
      list.innerHTML = items.map((item, i) => {
        const title = (lang === 'da' ? item.title : (item[`title_${lang}`] || item.title));
        const link = item.link || '#';
        const dt = formatNewsDateTime(item.pubDate);
        return `
          <a href="${link}" target="_blank" rel="noopener" class="block py-3 px-3 -mx-3 rounded-lg hover:bg-slate-200/40 transition-colors group">
            <span class="text-xs nordic-muted font-medium">${dt}</span>
            <span class="nordic-accent text-base block mt-0.5 group-hover:underline">${title}</span>
          </a>`;
      }).join('');
      list.classList.remove('hidden');
    }

    async function loadNewsWithTranslations(items) {
      if (!items?.length) {
        document.getElementById('news-loading').classList.add('hidden');
        document.getElementById('news-error').textContent = 'æš‚æ—¶æ— æ³•åŠ è½½ DR æ–°é—»';
        document.getElementById('news-error').classList.remove('hidden');
        return;
      }
      newsData = items;
      document.getElementById('news-loading').classList.add('hidden');
      setNewsLang('en');
      for (const item of items) {
        item.title_zh = await translateText(item.title, 'zh');
        item.title_en = await translateText(item.title, 'en');
      }
      setNewsLang(currentLang);
    }

    async function init() {
      updateClocks();
      setInterval(updateClocks, 1000);

      document.getElementById('lang-en').onclick = () => setNewsLang('en');
      document.getElementById('lang-zh').onclick = () => setNewsLang('zh');
      document.getElementById('lang-da').onclick = () => setNewsLang('da');

      const newsItems = await fetchDRNews();
      loadNewsWithTranslations(newsItems || []);

      try {
        const [beijingData, denmarkData] = await Promise.all([
          fetchWeather(39.9042, 116.4074, 'Asia/Shanghai'),
          fetchWeather(55.6761, 12.5683, 'Europe/Copenhagen'),
        ]);
        renderWeather('beijing', beijingData, 'zh');
        renderWeather('denmark', denmarkData, 'zh');
      } catch (e) {
        document.getElementById('beijing-weather-loading').classList.add('hidden');
        document.getElementById('denmark-weather-loading').classList.add('hidden');
        document.getElementById('beijing-error').textContent = 'åŒ—äº¬å¤©æ°”åŠ è½½å¤±è´¥';
        document.getElementById('beijing-error').classList.remove('hidden');
        document.getElementById('denmark-error').textContent = 'ä¸¹éº¦å¤©æ°”åŠ è½½å¤±è´¥';
        document.getElementById('denmark-error').classList.remove('hidden');
      }
    }

    init();
  </script>
</body>
</html>
